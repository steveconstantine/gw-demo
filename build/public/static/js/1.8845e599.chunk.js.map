{"version":3,"file":"static/js/1.8845e599.chunk.js","sources":["webpack:///./src/components/CustomerAuth.js"],"sourcesContent":["import React, {Component} from 'react';\nimport { graphql, compose } from 'react-apollo';\nimport gql from 'graphql-tag';\nimport PropTypes from 'prop-types';\nimport { TextField } from 'gestalt';\n\nclass CustomerAuth extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      email: '',\n      password: '',\n      nonFieldErrorMessage: null,\n      emailErrorMessage: null,\n      passwordErrorMessage: null\n    };\n\n    this.handleInputChange = this.handleInputChange.bind(this);\n    this.handleInputChangePassword = this.handleInputChangePassword.bind(this);\n    this.createCustomerAccount = this.createCustomerAccount.bind(this);\n    this.resetErrorMessages = this.resetErrorMessages.bind(this);\n    this.resetInputFields = this.resetInputFields.bind(this);\n  }\n\n  static propTypes = {\n    customerCreate: PropTypes.func.isRequired,\n    customerAccessTokenCreate: PropTypes.func.isRequired,\n  }\n\n  handleInputChange(value) {\n      this.setState({email: value.value});\n  }\n  \n  handleInputChangePassword(value) {\n      this.setState({password : value.value});\n  }\n\n  resetErrorMessages(){\n    this.setState({\n      nonFieldErrorMessage: null,\n      emailErrorMessage: null,\n      passwordErrorMessage: null\n    });\n  }\n\n  resetInputFields(){\n    this.setState({\n      email: '',\n      password: ''\n    });\n  }\n\n  handleSubmit(email, password){\n    this.resetErrorMessages();\n    if (this.props.newCustomer) {\n      this.createCustomerAccount(email, password)\n    } else {\n      this.loginCustomerAccount(email, password)\n    }\n  }\n\n  createCustomerAccount(email, password){\n    const input = {\n      email: email,\n      password: password\n    }\n    this.props.customerCreate(\n      { variables: { input }\n      }).then((res) => {\n        if (res.data.customerCreate.customer){\n           this.props.closeCustomerAuth();\n           this.props.showAccountVerificationMessage();\n        } else {\n          res.data.customerCreate.userErrors.forEach(function (error) {\n            if (error.field) {\n              this.setState({\n                [error.field + \"ErrorMessage\"]: error.message\n              });\n            } else {\n              this.setState({\n                nonFieldErrorMessage: error.message\n              });\n            }\n          }.bind(this));\n        }\n    });\n  }\n\n  loginCustomerAccount(email, password){\n    const input = {\n      email: email,\n      password: password\n    }\n    this.props.customerAccessTokenCreate(\n      { variables: { input }\n      }).then((res) => {\n      if (res.data.customerAccessTokenCreate.customerAccessToken) {\n        this.props.associateCustomerCheckout(res.data.customerAccessTokenCreate.customerAccessToken.accessToken);\n        localStorage.setItem('token', res.data.customerAccessTokenCreate.customerAccessToken.accessToken);\n      } else {\n        res.data.customerAccessTokenCreate.userErrors.forEach(function (error) {\n          if (error.field != null) {\n            this.setState({\n              [error.field + \"ErrorMessage\"]: error.message\n            });\n          } else {\n            this.setState({\n              nonFieldErrorMessage: error.message\n            });\n          }\n        }.bind(this));\n      }\n    });\n  }\n\n  render() {\n    return (\n      <div className={`CustomerAuth ${this.props.isCustomerAuthOpen ? 'CustomerAuth--open' : ''}`}>\n        <div className=\"CustomerAuth__body\">\n          <h2 className=\"CustomerAuth__heading\">{this.props.newCustomer ? 'Create your Account' : 'Log in to your account'}</h2>\n          {this.state.nonFieldErrorMessage &&\n            <div className=\"error\">{this.state.nonFieldErrorMessage}</div>\n          }\n          <label className=\"CustomerAuth__credential\">\n            <TextField className=\"CustomerAuth__input\" placeholder=\"Email\" name={\"email\"} value={this.state.email} onChange={this.handleInputChange} />\n            {this.state.emailErrorMessage &&\n              <div className=\"error\">{this.state.emailErrorMessage}</div>\n            }\n          </label>\n          <label className=\"CustomerAuth__credential\">\n            <TextField className=\"CustomerAuth__input\" type={'password'} placeholder=\"Password\" name={\"password\"} value={this.state.password} onChange={this.handleInputChangePassword} />\n            {this.state.passwordErrorMessage &&\n              <div className=\"error\">{this.state.passwordErrorMessage}</div>\n            }\n          </label>\n          <button className=\"CustomerAuth__submit button\" type=\"submit\" onClick={() => this.handleSubmit(this.state.email, this.state.password)}>{this.props.newCustomer ? 'Create Account' : 'Log in'}</button>\n        </div>\n        <button\n          onClick={() => { this.props.closeCustomerAuth(); this.resetErrorMessages(); this.resetInputFields();}}\n          className=\"CustomerAuth__close\">\n          Ã—\n        </button>\n      </div>\n\n    )\n  }\n}\n\nconst customerCreate = gql`\n  mutation customerCreate($input: CustomerCreateInput!) {\n    customerCreate(input: $input) {\n      userErrors {\n        field\n        message\n      }\n      customer {\n        id\n      }\n    }\n  }\n`;\n\nconst customerAccessTokenCreate = gql`\n  mutation customerAccessTokenCreate($input: CustomerAccessTokenCreateInput!) {\n    customerAccessTokenCreate(input: $input) {\n      userErrors {\n        field\n        message\n      }\n      customerAccessToken {\n        accessToken\n        expiresAt\n      }\n    }\n  }\n`;\n\nconst CustomerAuthWithMutation = compose(\n  graphql(customerCreate, {name: \"customerCreate\"}),\n  graphql(customerAccessTokenCreate, {name: \"customerAccessTokenCreate\"})\n)(CustomerAuth);\n\nexport default CustomerAuthWithMutation;\n"],"mappings":"AAMA","sourceRoot":""}